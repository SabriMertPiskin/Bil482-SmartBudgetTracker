<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Smart Budget Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2rem;
        }

        input,
        select {
            margin: 0.5rem 0;
            padding: 0.3rem;
            width: 100%;
            max-width: 300px;
        }

        button {
            padding: 0.5rem 1rem;
            margin-top: 0.5rem;
        }

        table {
            border-collapse: collapse;
            margin-top: 2rem;
            width: 100%;
            max-width: 700px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 0.5rem;
            text-align: left;
        }

        tr:hover {
            background-color: #f9f9f9;
        }
    </style>
</head>

<body>

    <h1>Smart Budget Tracker</h1>

    <h2>Add / Edit Expense</h2>
    <form id="expenseForm">
        <input type="hidden" id="expenseId" />
        <label>
            Title:<br />
            <input type="text" id="title" required />
        </label><br />
        <label>
            Amount:<br />
            <input type="number" id="amount" step="0.01" min="0" required />
        </label><br />
        <label>
            Category:<br />
            <input type="text" id="category" required />
        </label><br />
        <label>
            Date:<br />
            <input type="date" id="date" required />
        </label><br />
        <button type="submit">Save Expense</button>
        <button type="button" id="cancelEdit" style="display:none;">Cancel Edit</button>
    </form>

    <h2>Expense List</h2>
    <table id="expenseTable">
        <thead>
            <tr>
                <th>Title</th>
                <th>Amount</th>
                <th>Category</th>
                <th>Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const apiUrl = 'http://localhost:8080/expenses'; // Backend URL

        const expenseForm = document.getElementById('expenseForm');
        const expenseIdInput = document.getElementById('expenseId');
        const titleInput = document.getElementById('title');
        const amountInput = document.getElementById('amount');
        const categoryInput = document.getElementById('category');
        const dateInput = document.getElementById('date');
        const cancelEditBtn = document.getElementById('cancelEdit');
        const expenseTableBody = document.querySelector('#expenseTable tbody');

        // Fetch and render expenses
        async function fetchExpenses() {
            try {
                const res = await fetch(apiUrl);
                const expenses = await res.json();
                renderExpenses(expenses);
            } catch (e) {
                alert('Error loading expenses.');
            }
        }

        function renderExpenses(expenses) {
            expenseTableBody.innerHTML = '';
            expenses.forEach(expense => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
        <td>${expense.title}</td>
        <td>${expense.amount.toFixed(2)}</td>
        <td>${expense.category}</td>
        <td>${new Date(expense.date).toLocaleDateString()}</td>
        <td>
          <button onclick="editExpense(${expense.id})">Edit</button>
          <button onclick="deleteExpense(${expense.id})">Delete</button>
        </td>
      `;
                expenseTableBody.appendChild(tr);
            });
        }

        // Form submit handler (add or edit)
        expenseForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = expenseIdInput.value;
            const expenseData = {
                title: titleInput.value.trim(),
                amount: parseFloat(amountInput.value),
                category: categoryInput.value.trim(),
                date: dateInput.value ? new Date(dateInput.value).toISOString() : new Date().toISOString()
            };

            try {
                if (id) {
                    // Edit
                    const res = await fetch(`${apiUrl}/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(expenseData)
                    });
                    if (!res.ok) throw new Error('Update failed');
                } else {
                    // Add
                    const res = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(expenseData)
                    });
                    if (!res.ok) throw new Error('Add failed');
                }
                resetForm();
                fetchExpenses();
            } catch (err) {
                alert(err.message);
            }
        });

        // Edit expense: fill form with selected data
        window.editExpense = async function (id) {
            try {
                const res = await fetch(`${apiUrl}/${id}`);
                if (!res.ok) throw new Error('Expense not found');
                const expense = await res.json();
                expenseIdInput.value = expense.id;
                titleInput.value = expense.title;
                amountInput.value = expense.amount;
                categoryInput.value = expense.category;
                dateInput.value = expense.date ? expense.date.split('T')[0] : '';
                cancelEditBtn.style.display = 'inline-block';
            } catch {
                alert('Failed to load expense for editing.');
            }
        }

        // Delete expense
        window.deleteExpense = async function (id) {
            if (!confirm('Are you sure you want to delete this expense?')) return;
            try {
                const res = await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
                if (!res.ok) throw new Error('Delete failed');
                fetchExpenses();
            } catch {
                alert('Failed to delete expense.');
            }
        }

        // Cancel editing
        cancelEditBtn.addEventListener('click', () => {
            resetForm();
        });

        function resetForm() {
            expenseForm.reset();
            expenseIdInput.value = '';
            cancelEditBtn.style.display = 'none';
        }

        // Initialize
        fetchExpenses();
    </script>

</body>

</html>